<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <h1 class="text-2xl font-bold text-gray-900">Painel Administrativo</h1>
        <div class="flex items-center space-x-4">
          <span class="text-sm text-gray-600">
            Olá, {{ currentUser?.email }}
          </span>
          <button
            (click)="logout()"
            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium"
          >
            Sair
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Adicionar Produto -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">
        {{ editingProduct ? 'Editar Produto' : 'Adicionar Novo Produto' }}
      </h2>

      <form (ngSubmit)="saveProduct()" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700"
              >Nome</label
            >
            <input
              type="text"
              [(ngModel)]="productForm.name"
              name="name"
              required
              class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
            />
          </div>

          <div>
            <label for="price" class="block text-sm font-medium text-gray-700"
              >Preço</label
            >
            <input
              type="number"
              [(ngModel)]="productForm.price"
              name="price"
              step="0.01"
              required
              class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
            />
          </div>

          <div>
            <label
              for="category"
              class="block text-sm font-medium text-gray-700"
              >Categoria</label
            >
            <select
              [(ngModel)]="productForm.category"
              name="category"
              required
              class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
            >
              <option value="">Selecione uma categoria</option>
              <option value="vestidos">Vestidos</option>
              <option value="blazers">Blazers</option>
              <option value="calcas">Calças</option>
              <option value="blusas">Blusas</option>
              <option value="saias">Saias</option>
              <option value="esportivo">Esportivo</option>
            </select>
          </div>

          <div>
            <label for="sizes" class="block text-sm font-medium text-gray-700"
              >Tamanhos (separados por vírgula)</label
            >
            <input
              type="text"
              [(ngModel)]="productForm.sizes"
              name="sizes"
              placeholder="P, M, G, GG"
              class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
            />
          </div>

          <div>
            <label for="colors" class="block text-sm font-medium text-gray-700"
              >Cores (separadas por vírgula)</label
            >
            <input
              type="text"
              [(ngModel)]="productForm.colors"
              name="colors"
              placeholder="Azul, Rosa, Preto"
              class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
            />
          </div>

          <div class="md:col-span-2">
            <label
              for="imageUpload"
              class="block text-sm font-medium text-gray-700 mb-2"
              >Upload de Imagens</label
            >
            <div class="space-y-4">
              <!-- Input de arquivo -->
              <div class="flex items-center space-x-4">
                <input
                  type="file"
                  id="imageUpload"
                  multiple
                  accept="image/*"
                  (change)="onFileSelected($event)"
                  class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100"
                />
                <button
                  type="button"
                  (click)="uploadImages()"
                  [disabled]="selectedFiles.length === 0 || uploading"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium disabled:opacity-50"
                >
                  {{ uploading ? 'Enviando...' : 'Enviar Imagens' }}
                </button>
              </div>

              <!-- Preview das imagens selecionadas -->
              <div
                *ngIf="selectedFiles.length > 0"
                class="grid grid-cols-2 md:grid-cols-4 gap-4"
              >
                <div
                  *ngFor="let file of selectedFiles; let i = index"
                  class="relative"
                >
                  <img
                    [src]="getFilePreview(file)"
                    [alt]="'Preview ' + (i + 1)"
                    class="w-full h-24 object-cover rounded-lg border border-gray-300"
                  />
                  <button
                    type="button"
                    (click)="removeSelectedFile(i)"
                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600"
                  >
                    ×
                  </button>
                </div>
              </div>

              <!-- Imagens já enviadas -->
              <div *ngIf="uploadedImages.length > 0" class="space-y-2">
                <div class="block text-sm font-medium text-gray-700">
                  Imagens Enviadas:
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div
                    *ngFor="let image of uploadedImages; let i = index"
                    class="relative"
                  >
                    <img
                      [src]="image"
                      [alt]="'Imagem ' + (i + 1)"
                      class="w-full h-24 object-cover rounded-lg border border-gray-300"
                    />
                    <button
                      type="button"
                      (click)="removeUploadedImage(i)"
                      class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600"
                    >
                      ×
                    </button>
                  </div>
                </div>
              </div>

              <!-- Campo de texto para URLs (fallback) -->
              <div class="mt-4">
                <label
                  for="manualImages"
                  class="block text-sm font-medium text-gray-700 mb-2"
                >
                  Ou adicione URLs de imagens (separadas por vírgula)
                </label>
                <input
                  type="text"
                  id="manualImages"
                  [(ngModel)]="productForm.images"
                  name="images"
                  placeholder="https://exemplo.com/imagem1.jpg, https://exemplo.com/imagem2.jpg"
                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
                />
              </div>
            </div>
          </div>
        </div>

        <div>
          <label
            for="description"
            class="block text-sm font-medium text-gray-700"
            >Descrição</label
          >
          <textarea
            [(ngModel)]="productForm.description"
            name="description"
            rows="3"
            required
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-pink-500 focus:border-pink-500"
          ></textarea>
        </div>

        <div class="flex items-center space-x-4">
          <label class="flex items-center">
            <input
              type="checkbox"
              [(ngModel)]="productForm.featured"
              name="featured"
              class="rounded border-gray-300 text-pink-600 focus:ring-pink-500"
            />
            <span class="ml-2 text-sm text-gray-700">Produto em destaque</span>
          </label>

          <label class="flex items-center">
            <input
              type="checkbox"
              [(ngModel)]="productForm.in_stock"
              name="in_stock"
              class="rounded border-gray-300 text-pink-600 focus:ring-pink-500"
            />
            <span class="ml-2 text-sm text-gray-700">Em estoque</span>
          </label>
        </div>

        <div class="flex space-x-4">
          <button
            type="submit"
            [disabled]="saving"
            class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded-lg font-medium disabled:opacity-50"
          >
            {{
              saving
                ? 'Salvando...'
                : editingProduct
                ? 'Atualizar'
                : 'Adicionar'
            }}
          </button>

          <button
            type="button"
            (click)="cancelEdit()"
            *ngIf="editingProduct"
            class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg font-medium"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de Produtos -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">
          Produtos Cadastrados
        </h3>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Produto
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Categoria
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Preço
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Ações
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let product of products">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="h-10 w-10 flex-shrink-0">
                    <img
                      [src]="product.images[0]"
                      [alt]="product.name"
                      class="h-10 w-10 rounded-full object-cover"
                    />
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {{ product.name }}
                    </div>
                    <div class="text-sm text-gray-500">
                      {{ product.description.substring(0, 50) }}...
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"
                >
                  {{ product.category }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                R$ {{ product.price.toFixed(2).replace('.', ',') }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  [class]="
                    product.in_stock
                      ? 'bg-green-100 text-green-800'
                      : 'bg-red-100 text-red-800'
                  "
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                >
                  {{ product.in_stock ? 'Em estoque' : 'Esgotado' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button
                  (click)="editProduct(product)"
                  class="text-pink-600 hover:text-pink-900 mr-4"
                >
                  Editar
                </button>
                <button
                  (click)="deleteProduct(product.id)"
                  class="text-red-600 hover:text-red-900"
                >
                  Excluir
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
